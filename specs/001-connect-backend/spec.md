# Feature Specification: Подключение фронтенда к API дилемм

**Feature Branch**: `001-connect-backend`  
**Created**: 2026-01-21  
**Status**: Draft  
**Input**: User description: "подключи к моему фронтенду бэкэгд. Бэкенд задеплоен по адресу https://dilemma-production-0f6b.up.railway.app/api/docs"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Прохождение дилеммы с живыми данными (Priority: P1)

Пользователь открывает веб-приложение, выбирает дилему из списка, делает первоначальный выбор, получает фидбэк и фиксирует финальное решение, при этом все данные и операции проходят через продакшен‑API, а не через захардкоженные данные на фронтенде.

**Why this priority**: Это основной пользовательский сценарий, который должен работать на реальных данных, чтобы продукт имел практическую ценность и мог использовать накопленную статистику.

**Independent Test**: Можно отдельно протестировать только один сценарий прохождения одной дилеммы, используя задеплоенный API: проверить, что список дилем загружается с сервера, выбор и фидбэк сохраняются и возвращаются сервером, а финальное решение фиксируется и отображается пользователю.

**Acceptance Scenarios**:

1. **Given** пользователь заходит в веб‑приложение впервые, **When** он открывает страницу выбора дилем, **Then** список дилем загружается с серверной части и отображается без использования локально захардкоженных данных.
2. **Given** пользователь выбрал конкретную дилему из списка, **When** он делает первоначальный выбор варианта (A или B), **Then** выбор отправляется в серверную систему, сервер возвращает фидбэк‑текст, и этот текст отображается пользователю.
3. **Given** пользователь получил фидбэк по дилеме, **When** он подтверждает или меняет финальное решение, **Then** финальное решение успешно фиксируется на серверной стороне и после обновления страницы пользователь видит актуальное состояние по этой дилеме.

---

### User Story 2 - Согласованность состояния между фронтендом и сервером (Priority: P1)

Пользователь, вернувшись в приложение позже или открыв его на другом устройстве, видит на фронтенде данные, полностью соответствующие тому, что хранится в серверной системе (пройденные дилеммы, выборы, траектории и статистика).

**Why this priority**: Без синхронизации состояния с сервером пользователи будут видеть устаревшие или противоречивые данные, что подрывает доверие к системе и делает аналитику бессмысленной.

**Independent Test**: Можно протестировать только операции чтения состояния для существующего пользователя: загрузка его истории решений и связанной статистики с сервера и сравнение с ожидаемыми данными без изменения backend‑логики.

**Acceptance Scenarios**:

1. **Given** пользователь уже прошёл хотя бы одну дилему, **When** он открывает приложение в новом браузере или после очистки локальных данных, **Then** фронтенд запрашивает историю решений и статистику у серверной части и отображает актуальные данные.
2. **Given** пользователю были добавлены новые данные на сервере (например, через другой клиент), **When** он обновляет страницу, **Then** на фронтенде показывается обновлённая информация, совпадающая с серверными данными.

---

### User Story 3 - Устойчивое поведение при сбоях API (Priority: P2)

Пользователь, столкнувшись с временными проблемами доступа к серверу (ошибка сети, ошибка сервера, таймаут), получает понятные сообщения и может повторить попытку, не теряя уже сделанные действия там, где это возможно.

**Why this priority**: Система должна оставаться предсказуемой и понятной при сбоях, иначе пользователи будут считать продукт "ломаным" и перестанут им пользоваться.

**Independent Test**: Можно отдельно смоделировать ошибки ответов API (например, недоступность сервера, ответ с ошибкой) и проверить, что фронтенд корректно реагирует: показывает сообщения, не ломает основной флоу и даёт возможность повторить действия.

**Acceptance Scenarios**:

1. **Given** сервер временно недоступен при загрузке списка дилем, **When** пользователь открывает страницу выбора дилем, **Then** он видит понятное сообщение об ошибке загрузки и может повторить попытку без перезагрузки всего приложения.
2. **Given** при отправке первоначального выбора возникает ошибка сервера, **When** пользователь пытается сделать выбор, **Then** пользователь видит сообщение о сбое, выбор на фронтенде не считается успешно зафиксированным, и у него есть возможность отправить выбор повторно.
3. **Given** сервер возвращает некорректный или пустой ответ, **When** фронтенд получает такой ответ, **Then** вместо "тихого" падения пользователь видит контролируемое сообщение об ошибке, а приложение продолжает работать.

---

### Edge Cases

- Что происходит, если сервер возвращает пустой список дилем или список только с неактивными дилемами?
- Как ведёт себя фронтенд, если по конкретной дилеме сервер возвращает ошибку 404 (дилема удалена или переименована)?
- Что происходит, если пользователь открывает несколько вкладок и выполняет действия в них параллельно, а состояние дилем обновляется на сервере между запросами?
- Как обрабатываются ситуации, когда пользователь теряет соединение в момент отправки initial или final choice (повторные попытки, отображаемое состояние)?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Frontend MUST получать список активных дилем с backend‑API и отображать его пользователю вместо локально захардкоженных данных.
- **FR-002**: Frontend MUST запрашивать подробную информацию по выбранной дилеме у backend‑API и использовать её для отображения текстов вариантов и фидбэков.
- **FR-003**: Frontend MUST отправлять первоначальный выбор пользователя (A или B) для выбранной дилемы в backend‑API и отображать фидбэк‑текст, возвращённый сервером.
- **FR-004**: Frontend MUST отправлять финальное решение пользователя (подтверждение или смена выбора) в backend‑API и отображать актуальное состояние дилемы после успешного сохранения.
- **FR-005**: Frontend MUST получать и отображать персональную историю решений пользователя, загружая её с backend‑API.
- **FR-006**: Frontend MUST получать и отображать агрегированную статистику по дилемам (включая траектории AA/AB/BB/BA), используя данные backend‑API.
- **FR-007**: Frontend MUST обеспечивать согласованность идентификатора пользователя между запросами к backend‑API, чтобы все действия одного пользователя связывались на сервере.
- **FR-008**: Frontend MUST корректно обрабатывать ошибки ответов backend‑API (сети, 4xx, 5xx), отображая понятные сообщения и не ломая основной пользовательский сценарий.
- **FR-009**: Frontend MUST не отображать данные, которые противоречат ответам backend‑API (например, не показывать дилему как несыгранную, если сервер сообщает, что пользователь уже участвовал).
- **FR-010**: Frontend MUST предусматривать возможность простого переключения между средами (например, продакшен/локальная разработка) без изменения пользовательского поведения.

### Key Entities *(include if feature involves data)*

- **Пользовательский клиент**: Представляет браузер или устройство пользователя, через которое выполняются запросы к серверной системе дилем. Хранит локальный идентификатор пользователя и текущий контекст (выбранная дилема, сделанные выборы).
- **Backend‑API дилемм**: Серверная система, предоставляющая список дилем, детали дилем, приём initial и final choice, историю решений и агрегированную статистику. Является единственным источником правды для пользовательских данных и статистики.
- **Сеанс пользователя**: Связка между конкретным пользователем и его действиями в приложении, которая обеспечивается стабильным использованием одного и того же идентификатора во всех запросах к backend‑API.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Не менее 95% пользователей, открывающих приложение при корректно работающем backend‑API, видят загруженный с сервера список дилем менее чем за 3 секунды.
- **SC-002**: Не менее 90% попыток прохождения полной дилеммы (выбор дилемы → initial choice → фидбэк → final choice) успешно завершаются с сохранением данных на сервере без несоответствия отображаемого состояния.
- **SC-003**: В течение недели тестового использования не фиксируется случаев рассинхронизации между фронтендом и сервером по ключевым полям (initial_choice, final_choice, changed_mind, путь AA/AB/BB/BA) по результатам выборочной проверки.
- **SC-004**: При имитации недоступности backend‑API во время пользовательских действий не менее 95% ошибок отображаются как понятные сообщения, а приложение остаётся работоспособным (возможность повторить действие или вернуться к выбору дилем).

## Assumptions

- Frontend и backend используют уже согласованный контракт API, описанный в спецификациях системы дилем и доступный по адресу документации сервера.
- Backend‑служба доступна по стабильному публичному URL, используемому фронтендом в продакшен‑окружении.
- Идентификатор пользователя может храниться и повторно использоваться на фронтенде таким образом, чтобы сервер корректно объединял все действия одного пользователя.
- На момент интеграции основной функционал backend‑API (дилемы, решения, статистика) уже реализован и протестирован отдельно.
