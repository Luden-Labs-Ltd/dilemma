# Data Model: Подключение фронтенда к API дилемм

**Feature**: `001-connect-backend`  
**Scope**: Фронтенд‑ориентированное представление данных, получаемых из backend‑API, без изменения серверной доменной модели.

---

## 1. Пользовательский клиент

- **Описание**: Представляет анонимного пользователя, взаимодействующего с системой дилем через браузер.
- **Источник данных**: Локально в браузере.
- **Поля**:
  - `clientUuid: string` — UUID пользователя, генерируется на фронте один раз и сохраняется в `localStorage`.
  - `createdAt?: string` — (опционально) время первого создания UUID на клиенте.
- **Поведение/правила**:
  - UUID должен быть валидным `UUIDv4`.
  - Один и тот же UUID используется во всех запросах к backend‑API в заголовке `X-User-UUID`.

---

## 2. Дилема (frontend view)

- **Описание**: Представление дилемы, возвращаемой backend‑API, для отображения на фронтенде.
- **Источник данных**: Эндпоинты списка и деталей дилем из OpenAPI `api-spec.json`.
- **Поля (основные)**:
  - `id: string` — идентификатор дилемы (может быть UUID или строковый ключ).
  - `name: string` — машиночитаемое имя дилемы (используется в URL/запросах).
  - `title: string` — заголовок дилемы.
  - `description: string` — текстовое описание ситуации.
  - `optionATitle: string` — заголовок варианта A.
  - `optionADescription: string` — описание варианта A.
  - `optionBTitle: string` — заголовок варианта B.
  - `optionBDescription: string` — описание варианта B.
  - `isActive: boolean` — признак того, что дилема доступна для участия.
- **Производные поля на фронтенде**:
  - `isCompletedByUser: boolean` — признак того, что текущий пользователь уже прошёл эту дилему (вычисляется по истории решений/ответам API).

---

## 3. Решение пользователя (frontend view)

- **Описание**: Данные по конкретному участию пользователя в дилеме, агрегированные для нужд фронтенда.
- **Источник данных**: Эндпоинты initial/final choice и история решений из backend‑API.
- **Поля**:
  - `dilemmaName: string` — ссылка на участвующую дилему.
  - `initialChoice: 'A' | 'B'` — первоначальный выбор пользователя.
  - `finalChoice: 'A' | 'B' | null` — финальное решение (может быть отсутствующим до завершения).
  - `changedMind: boolean` — признак изменения мнения (вычисляется на сервере).
  - `path: 'AA' | 'AB' | 'BB' | 'BA'` — траектория пользователя по дилеме.
  - `initialAt: string` — время первоначального выбора.
  - `finalAt?: string` — время финального решения.
  - `timeToDecide?: number` — длительность обдумывания в секундах (вычисляется на сервере).
  - `feedbackText: string` — текст фидбэка, полученный после initial choice.
- **Поведение/правила**:
  - Фронтенд не пересчитывает `changedMind` и `path`, а доверяет значениям, пришедшим с сервера.
  - Если `finalChoice` отсутствует, UI должен отображать состояние "в процессе".

---

## 4. Статистика по дилеме (frontend view)

- **Описание**: Агрегированная статистика по одной дилеме для отображения пользователю.
- **Источник данных**: Статистические эндпоинты backend‑API.
- **Поля**:
  - `dilemmaName: string` — ссылка на дилему.
  - `totalParticipants: number` — общее количество участников.
  - `pathAA: number` — количество/процент участников, выбравших AA.
  - `pathAB: number` — количество/процент участников, выбравших AB.
  - `pathBB: number` — количество/процент участников, выбравших BB.
  - `pathBA: number` — количество/процент участников, выбравших BA.
  - `changedMindRate: number` — доля пользователей, изменивших мнение.
  - `averageTimeToDecide: number` — среднее время обдумывания (секунды или минуты, согласно API).
- **Поведение/правила**:
  - Фронтенд может нормализовать данные (например, перевод в проценты), но исходные значения берутся из сервера.
  - При недостаточном количестве участников UI может отображать упрощённую статистику (на основе спеки системы дилем).

---

## 5. Состояние фронтенд‑приложения (упрощённо)

- **Описание**: Логическое состояние, управляемое контекстами/хуками фронтенда.
- **Основные срезы состояния**:
  - `dilemmas: DilemmaView[]` — список дилем, загруженный с backend‑API.
  - `selectedDilemma: DilemmaView | null` — текущая выбранная дилема.
  - `userDecisions: UserDecisionView[]` — история решений текущего пользователя.
  - `dilemmaStats: Record<string, DilemmaStatsView>` — статистика по дилемам по ключу `dilemmaName`.
  - `loadingFlags` и `errorStates` — флаги загрузки/ошибок для основных операций (список дилем, initial/final choice, статистика).

---

## 6. Валидационные правила (frontend)

- Входные данные от пользователя (выбор варианта) валидируются на фронте по простым правилам:
  - выбор должен быть `'A'` или `'B'`;
  - отправка `finalChoice` возможна только после успешного `initialChoice` по данной дилеме (на уровне UI).
- Все сложные проверки (наличие дилемы, уникальность участия, корректность времени) остаются на стороне backend‑API, фронтенд не дублирует бизнес‑валидацию.

